worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;

    keepalive_timeout  65;

	server {
	    listen 80;
		
		gzip on;
		gzip_comp_level 2;
		gzip_http_version 1.0;
		gzip_proxied any;
		gzip_min_length 1100;
		gzip_buffers 16 8k;
		gzip_types text/plain text/html text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript;

		# Disable for IE < 6 because there are some known problems
		gzip_disable "MSIE [1-6].(?!.*SV1)";

		# Add a vary header for downstream proxies to avoid sending cached gzipped files to IE6
		gzip_vary on;
		
		pagespeed on;
		pagespeed FileCachePath /var/ngx_pagespeed_cache;  # Use tmpfs for best results

		#  Ensure requests for pagespeed optimized resources go to the pagespeed
		#  handler and no extraneous headers get set.
		location ~ "\.pagespeed\.([a-z]\.)?[a-z]{2}\.[^.]{10}\.[^.]+" { add_header "" ""; }
		location ~ "^/pagespeed_static/" { }
		location ~ "^/ngx_pagespeed_beacon$" { }

	    location / {
	        proxy_pass http://127.0.0.1:8080;
	        proxy_read_timeout 600s;
	        proxy_buffering off;
	        proxy_set_header Connection '';
	        proxy_http_version 1.1;
	        chunked_transfer_encoding off;
	    }
	}
}

daemon off;